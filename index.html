<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator - Create Professional Invoices</title>
    <meta name="description" content="Generate professional PDF invoices with ease">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>Invoice Generator</h1>
            <p class="subtitle">Create professional PDF invoices in seconds</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="editor">üìù Editor</button>
            <button class="tab-btn" data-tab="history">üìú History</button>
            <button class="tab-btn" data-tab="settings">‚öôÔ∏è Settings</button>
        </div>

        <main>
            <!-- Editor Tab -->
            <div id="editor-tab" class="tab-content active">
                <!-- Nested Tabs for Editor Sections -->
                <div class="nested-tabs" nooverflow>
                    <button class="nested-tab-btn active" data-nested-tab="your-info">üë§ Your Information</button>
                    <button class="nested-tab-btn" data-nested-tab="issued-to">üè¢ Issued To</button>
                    <button class="nested-tab-btn" data-nested-tab="invoice-details">üìã Invoice Details</button>
                    <button class="nested-tab-btn" data-nested-tab="items">üì¶ Items/Services</button>
                    <button class="nested-tab-btn" data-nested-tab="notes">üìù Notes</button>
                </div>

                <!-- Your Information Tab -->
                <div id="your-info-tab" class="nested-tab-content active">
                    <section class="card">
                        <div class="card-header">
                            <div class="card-icon">üë§</div>
                            <h2 class="card-title">Your Information</h2>
                        </div>

                        <!-- Issuer Profile Selection -->
                        <div
                            style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--border);">
                            <div class="form-group">
                                <label for="issuerSelect">Select Saved Profile</label>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <select id="issuerSelect" style="flex: 1;">
                                        <option value="">-- Select a profile --</option>
                                    </select>
                                    <button type="button" id="saveIssuerBtn" class="btn btn-secondary btn-sm"
                                        title="Save current profile">üíæ</button>
                                    <button type="button" id="deleteIssuerBtn" class="btn btn-secondary btn-sm"
                                        title="Delete selected profile">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="senderFirstName">First Name</label>
                                <input type="text" id="senderFirstName" placeholder="First Name" required>
                            </div>
                            <div class="form-group">
                                <label for="senderLastName">Last Name</label>
                                <input type="text" id="senderLastName" placeholder="Last Name" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="senderAddressLine1">Address Line 1</label>
                                <input type="text" id="senderAddressLine1" placeholder="Street address" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="senderAddressLine2">Address Line 2 (Optional)</label>
                                <input type="text" id="senderAddressLine2" placeholder="Apartment, suite, etc.">
                            </div>
                            <div class="form-group">
                                <label for="senderCity">City</label>
                                <input type="text" id="senderCity" placeholder="City" required>
                            </div>
                            <div class="form-group">
                                <label for="senderProvince">Province/State</label>
                                <input type="text" id="senderProvince" placeholder="Province/State" required>
                            </div>
                            <div class="form-group">
                                <label for="senderCountry">Country</label>
                                <input type="text" id="senderCountry" placeholder="Country" required>
                            </div>
                            <div class="form-group">
                                <label for="senderPostalCode">Postal Code</label>
                                <input type="text" id="senderPostalCode" placeholder="Postal Code" required>
                            </div>
                            <div class="form-group">
                                <label for="senderEmail">Email</label>
                                <input type="email" id="senderEmail" placeholder="Email" required>
                            </div>
                            <div class="form-group">
                                <label for="senderPhone">Phone</label>
                                <div class="phone-input-group">
                                    <select id="senderPhoneCountry" class="phone-country-select">
                                        <option value="+1" selected>üá®üá¶ +1</option>
                                        <option value="+1">üá∫üá∏ +1</option>
                                    </select>
                                    <input type="text" id="senderPhone" placeholder="(XXX) XXX-XXXX" required
                                        class="phone-number-input">
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Invoice Details Tab -->
                <div id="invoice-details-tab" class="nested-tab-content">
                    <section class="card">
                        <div class="card-header">
                            <div class="card-icon">üìã</div>
                            <h2 class="card-title">Invoice Details</h2>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="invoiceNumber">Invoice Number</label>
                                <input type="text" id="invoiceNumber" placeholder="Invoice Number" required>
                            </div>
                            <div class="form-group">
                                <label for="paymentMethod">Payment Method</label>
                                <input type="text" id="paymentMethod"
                                    placeholder="e.g., Interac, Bank Transfer, Credit Card" required>
                            </div>
                            <div class="form-group">
                                <label for="issueDate">Issue Date</label>
                                <input type="date" id="issueDate">
                            </div>
                            <div class="form-group">
                                <label for="dueDate">Due Date</label>
                                <input type="date" id="dueDate">
                            </div>
                            <div class="form-group">
                                <label for="invoiceStatus">Status (Watermark)</label>
                                <select id="invoiceStatus">
                                    <option value="">None</option>
                                    <option value="DRAFT">Draft</option>
                                    <option value="PAID">Paid</option>
                                    <option value="OVERDUE">Overdue</option>
                                    <option value="VOID">Void</option>
                                </select>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Issued To Tab -->
                <div id="issued-to-tab" class="nested-tab-content">
                    <section class="card">
                        <div class="card-header">
                            <div class="card-icon">üè¢</div>
                            <h2 class="card-title">Issued To</h2>
                        </div>

                        <!-- Client Selection -->
                        <div
                            style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--border);">
                            <div class="form-group">
                                <label for="clientSelect">Select Saved Client</label>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <select id="clientSelect" style="flex: 1;">
                                        <option value="">-- Select a client --</option>
                                    </select>
                                    <button type="button" id="saveClientBtn" class="btn btn-secondary btn-sm"
                                        title="Save current client">üíæ</button>
                                    <button type="button" id="deleteClientBtn" class="btn btn-secondary btn-sm"
                                        title="Delete selected client">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="recipientFirstName">First Name</label>
                                <input type="text" id="recipientFirstName" placeholder="First Name" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientLastName">Last Name</label>
                                <input type="text" id="recipientLastName" placeholder="Last Name" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="recipientAddressLine1">Address Line 1</label>
                                <input type="text" id="recipientAddressLine1" placeholder="Street address" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="recipientAddressLine2">Address Line 2 (Optional)</label>
                                <input type="text" id="recipientAddressLine2" placeholder="Apartment, suite, etc.">
                            </div>
                            <div class="form-group">
                                <label for="recipientCity">City</label>
                                <input type="text" id="recipientCity" placeholder="City" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientProvince">Province/State</label>
                                <input type="text" id="recipientProvince" placeholder="Province/State" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientCountry">Country</label>
                                <input type="text" id="recipientCountry" placeholder="Country" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientPostalCode">Postal Code</label>
                                <input type="text" id="recipientPostalCode" placeholder="Postal Code" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientEmail">Email</label>
                                <input type="email" id="recipientEmail" placeholder="Email" required>
                            </div>
                            <div class="form-group">
                                <label for="recipientPhone">Phone</label>
                                <div class="phone-input-group">
                                    <select id="recipientPhoneCountry" class="phone-country-select">
                                        <option value="+1" selected>üá®üá¶ +1</option>
                                        <option value="+1">üá∫üá∏ +1</option>
                                    </select>
                                    <input type="text" id="recipientPhone" placeholder="(XXX) XXX-XXXX" required
                                        class="phone-number-input">
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Items/Services Tab -->
                <div id="items-tab" class="nested-tab-content">
                    <section class="card">
                        <div class="card-header">
                            <div class="card-icon">üì¶</div>
                            <h2 class="card-title">Items / Services</h2>
                        </div>

                        <div class="table-wrapper">
                            <table id="itemsTable">
                                <thead>
                                    <tr>
                                        <th style="width: 50%">Product/Service</th>
                                        <th style="width: 15%">Quantity</th>
                                        <th style="width: 20%">Unit Price (CA$)</th>
                                        <th style="width: 15%">Amount (CA$)</th>
                                        <th style="width: 5%"></th>
                                    </tr>
                                </thead>
                                <tbody id="itemsTableBody">
                                    <tr data-row="0">
                                        <td>
                                            <input type="text" class="item-description"
                                                placeholder="Product or service description" required>
                                        </td>
                                        <td>
                                            <input type="number" class="item-quantity" min="1" value="1" step="1"
                                                required>
                                        </td>
                                        <td>
                                            <input type="number" class="item-price" min="0" value="0" step="0.01"
                                                required>
                                        </td>
                                        <td class="item-amount">CA$0.00</td>
                                        <td>
                                            <button type="button" class="btn btn-secondary btn-sm remove-item"
                                                title="Remove item">√ó</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="action-buttons">
                            <button type="button" id="addItemBtn" class="btn btn-secondary">
                                <span>+ Add Line Item</span>
                            </button>
                        </div>

                        <!-- Totals -->
                        <div class="totals">
                            <div class="total-row">
                                <span class="total-label">Subtotal:</span>
                                <span class="total-value" id="subtotal">CA$550.00</span>
                            </div>
                            <div class="total-row">
                                <span class="total-label">Shipping:</span>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span>CA$</span>
                                    <input type="number" id="shippingFee" value="0" min="0" step="0.01"
                                        style="width: 80px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: right;">
                                </div>
                            </div>
                            <div class="total-row">
                                <span class="total-label">Tax Rate:</span>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <input type="number" id="taxRate" value="0" min="0" max="100" step="0.01"
                                        style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: right;">
                                    <span>%</span>
                                </div>
                            </div>
                            <div class="total-row">
                                <span class="total-label">Tax Amount:</span>
                                <span class="total-value" id="taxAmount">CA$0.00</span>
                            </div>
                            <div class="total-row grand-total">
                                <span class="total-label">Total:</span>
                                <span class="total-value" id="grandTotal">CA$550.00</span>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Notes Tab -->
                <div id="notes-tab" class="nested-tab-content">
                    <section class="card">
                        <div class="card-header">
                            <div class="card-icon">üìù</div>
                            <h2 class="card-title">Notes</h2>
                        </div>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="notes">Notes (Payment Instructions, Terms, etc.)</label>
                                <textarea id="notes" rows="4"
                                    placeholder="Enter payment instructions, terms and conditions, or any other notes..."></textarea>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Floating Action Bar (visible across all nested tabs) -->
                <section class="generate-section" style="display: flex; gap: var(--spacing-md); align-items: center;">
                    <button type="button" id="newInvoiceBtn" class="btn btn-secondary btn-circle-action"
                        title="New Invoice">
                        ‚ûï
                    </button>
                    <button type="button" id="saveInvoiceBtn" class="btn btn-secondary btn-circle-action"
                        title="Save Invoice">
                        üíæ
                    </button>
                    <button type="button" id="generatePdfBtn" class="btn btn-secondary btn-circle-action"
                        title="Generate PDF">
                        üìÑ
                    </button>
                    <div id="statusMessage"></div>
                </section>
            </div>

            <!-- History Tab -->
            <div id="history-tab" class="tab-content">
                <section class="card">
                    <div class="card-header">
                        <div class="card-icon">üìú</div>
                        <h2 class="card-title">Invoice History</h2>
                    </div>
                    <div class="table-wrapper">
                        <table id="invoiceHistoryTable">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Date</th>
                                    <th>Client</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoiceHistoryBody">
                                <!-- Invoices will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <section class="card">
                    <div class="card-header">
                        <div class="card-icon">üíæ</div>
                        <h2 class="card-title">Data Management</h2>
                    </div>
                    <p style="margin-bottom: var(--spacing-md); color: var(--muted-foreground); font-size: 0.875rem;">
                        Backup your saved profiles and invoice history to a file or restore from a previous backup.
                    </p>
                    <div class="form-group" style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                        <button type="button" id="exportDataBtn" class="btn btn-secondary">
                            ‚¨áÔ∏è Export Backup
                        </button>
                        <button type="button" id="importDataBtn" class="btn btn-secondary">
                            ‚¨ÜÔ∏è Import Backup
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                    </div>
                </section>

                <section class="card" style="margin-top: var(--spacing-lg);">
                    <div class="card-header">
                        <div class="card-icon">üîê</div>
                        <h2 class="card-title">GitHub Backup (Private Repo)</h2>
                    </div>
                    <p style="margin-bottom: var(--spacing-md); color: var(--muted-foreground); font-size: 0.875rem;">
                        Automatically backup your data to a separate private GitHub repository using the GitHub API.
                    </p>

                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="githubToken">GitHub Personal Access Token (Fine-grained)</label>
                            <input type="password" id="githubToken" placeholder="github_pat_...">
                            <small style="color: var(--muted-foreground); font-size: 0.75rem;">
                                Create at: <a href="https://github.com/settings/personal-access-tokens/new"
                                    target="_blank">GitHub Settings ‚Üí Personal Access Tokens</a><br>
                                Required permissions: <strong>Contents (Read & Write)</strong> for your backup
                                repository
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="githubOwner">Repository Owner</label>
                            <input type="text" id="githubOwner" placeholder="your-username">
                        </div>
                        <div class="form-group">
                            <label for="githubRepo">Repository Name</label>
                            <input type="text" id="githubRepo" placeholder="invoice-backups">
                        </div>
                        <div class="form-group full-width">
                            <label for="githubBranch">Branch (optional)</label>
                            <input type="text" id="githubBranch" placeholder="main" value="main">
                        </div>
                    </div>

                    <div class="form-group"
                        style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-md);">
                        <button type="button" id="saveGithubConfig" class="btn btn-secondary">
                            üíæ Save Configuration
                        </button>
                        <button type="button" id="backupToGithub" class="btn btn-primary">
                            üöÄ Backup to GitHub Now
                        </button>
                        <button type="button" id="loadLatestBackup" class="btn btn-secondary">
                            ‚¨áÔ∏è Load Latest Backup
                        </button>
                    </div>

                    <div
                        style="margin-top: var(--spacing-md); padding: var(--spacing-sm); background: var(--accent); border-radius: 4px;">
                        <small style="color: var(--muted-foreground); font-size: 0.75rem;">
                            ‚ö†Ô∏è <strong>Security Note:</strong> Your token is stored in browser localStorage. Never share
                            your token.
                            Use a fine-grained token with minimal permissions (only Contents for your backup repo).
                        </small>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="app.js"></script>
</body>

</html>